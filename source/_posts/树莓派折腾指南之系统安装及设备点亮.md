title: 树莓派折腾指南之系统安装及设备点亮
date: 2018-01-07 22:48:11
tags: [树莓派]
category: [硬件]
---

# 树莓派折腾指南之系统安装及设备点亮
树莓派的系统安装方法有两种，一种是完全无头安装即不用网线，不用连接屏幕完成系统安装及设备正常点亮；一种是官方所提供的方式使用`NOOBS`辅助来安装。

在我看来，直接无头安装是最快捷的，不需要额外的设备，不需要额外的系统，不需要那么多操作，也减少了出错的可能。所以，这里推荐大家直接使用屋无头安装的方式。
<!--more-->

## 无头安装速成指南
所谓速成，是因为在30分钟以内你就能进入到自己的树莓派中一探其中的究竟了。

## 准备工作
所需设备及材料：
1. 树莓派
2. SD 卡（起码 8G 以上）

当然还有计算机，以及一台正常工作的路由器。

## 系统安装
首先在你的计算机上前往官网选择需要下载的树莓派官方支持系统：`RASPBIAN` （当然还有一系列其他类型的系统也可在官网找到）。

官方系统的下载地址是 [RASPBIAN](https://www.raspberrypi.org/downloads/raspbian/) ,官方提供两种系统版本，一是 WITH DESKTOP 即配置了桌面 GUI 环境的操作系统，另一个是 LITE 版本无桌面的最小版本。

目前的系统版本及相关内容如下：
![](http://7xjsv3.com1.z0.glb.clouddn.com/15153326797958.jpg)

这里可以根据你的需要选择，如果是新手，推荐选择桌面版本。

下载好系统包之后，下一步就是将系统烧录进入 SD 卡内，可以选择使用官方推荐的系统烧录工具 [Etcher](https://etcher.io/) ，点击上链接进入官网下载对应系统的版本即可，我这里使用的是 Mac 所以下载的 macOS 版本，下载完成之后安装并启动 Etcher。

Etcher 的使用基本是傻瓜式的，如其在官网的动图所示，首先选择你刚刚下载的系统包，然后将你 SD 卡插入 USB 读卡器中，并将读卡器接入电脑，点击 `Select drive` 选择你插入的 USB 设备，点击 `Flash` 即进入烧录系统的过程了。
这个过程快慢取决于烧录速度，静静等待它烧录完成就行了。

![](http://7xjsv3.com1.z0.glb.clouddn.com/15153330485682.jpg)


烧录完成之后，仅仅是完成了系统安装的第一步。

## 启动系统前的基本配置

在烧录完成之后，需要重新挂载刚刚携带 SD 卡的 USB 设备，打开其中的 `boot` 分区（文件夹），做以下三步操作

1. 打开 `boot` 文件夹内 `config.txt`  文件，如果是桌面版本需要将 `#hdmi_safe=1` 取消注释，即去掉前面的 `#`
2. 在 `config.txt` 同级目录下使用任一文本编辑器(UTF-8编码）新建一个名字是 `ssh` 的空白文件，无文件后缀名
3. 在 `config.txt` 同级目录下新建一个名为 `wpa_supplicant.conf` 的文件，内容如下：

```
country=GB
ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
update_config=1
network={
    ssid="你的Wifi名称，最好不含中文"
    psk="你的Wifi密码"
}
```

以上三步缺一不可。第一步是为了保证以后使用 HDMI 接入屏幕的时候有视频信号，第二步是为了能够使用 `ssh` 登录你的树莓派，第三步则保证你的树莓派一开机能够自动连接上你的路由器。

现在就完成了系统安装，选择弹出你的 sd 卡设备，将其插入到树莓派中。

系统启动后，上述刚刚新建的这两个文件都会被删除。如果你改了 Wifi 密码，还可以再做一次。

## 启动树莓派并SSH远程登录系统
将 SD 卡插入到树莓派后，将树莓派接通电源等待它自动开机，这里你可以使用 HDMI 线连接显示器以查看其启动结果，当然如果你有自信可以完全不用连接上显示器，直接使用 `ssh` 登录到树莓派内。

那么如何确定树莓派是否连接上了路由器呢？可以根据其是否在路由器内分配了 IP 地址来确定，这里有两种方法：
1. 直接进入到路由器的管理中心，比如使用浏览器打开 `http://192.168.1.1` ，查看已连接的设备中是否有一个名为 `raspberrypi` 的设备，查看其分配的路由器 IP 地址
如下图：
![](http://7xjsv3.com1.z0.glb.clouddn.com/15153343484307.jpg)
2. 如果你的计算机是 `*nix` 设备，在终端使用 `arp -a`  命令，查看当前的路由中所有已连接的 IP 地址
![](http://7xjsv3.com1.z0.glb.clouddn.com/15153344267473.jpg)

找到了 IP 地址之后就可以使用 ssh 登陆到树莓派了，在 Mac 中使用终端即可，其步骤如下图
![](http://7xjsv3.com1.z0.glb.clouddn.com/15153347383609.jpg)
注意用户名是 `pi`，点击连接即可，这里可能需要你添加 key 到本地 `know_host`
中，输入 `yes` 即可。Windows 可以使用 `putty`，具体的操作这里不再赘述。

**默认的 `pi` 用户的密码是 `raspberry`。**

当然对于 macOS 或 linux 还有一种更加直接方便的 `ssh` 登陆方式，不需要 IP 地址，直接等树莓派通电启动之后，在终端内输入 `ssh pi@raspberrypi.local` 即可。
![](http://7xjsv3.com1.z0.glb.clouddn.com/15153349649992.jpg)

如果出现上界面即表示树莓派已经成功启动系统了。

## 使用 VNC 远程登录
如果你安装的是带桌面版本的树莓派，可以使用 VNC 远程登录桌面环境而不必需要额外的 HDMI 设备线连接屏幕、额外的键鼠连接树莓派。

如何使用 VNC 呢？

首先在 ssh 登陆进入树莓派之后，先对系统进行基本的配置，第一个就是换源，因为国内网络环境导致从官方的地址来安装和更新软件及系统速度可能会非常慢，这里讲软件源换成国内的镜像源，比如阿里云的，其步骤如下：

在 ssh 终端中输入 `sudo nano /etc/apt/sources.list` 
可以直接删除原有的内容，也可以在前面加上 # 将其注释掉，然后在下面加入两行。
```
deb http://mirrors.aliyun.com/raspbian/raspbian/ stretch main non-free contrib rpi
deb-src http://mirrors.aliyun.com/raspbian/raspbian/ stretch main non-free contrib rpi
```
然后输入 `sudo apt-get update` 更新软件索引清单，
输入 `sudo apt-get upgrade` 更新相关软件依赖。

完成之后输入 `sudo apt-get install tightvncserver` 为树莓派安装 VNC 服务，安装完成之后输入 `tightvncserver`，这里会需要你输入 VNC 连接密码，确定输入即可，启动 VNC 服务。

Mac 中，在文件夹 `Finder` 的菜单中，打开前往下的连接服务器，然后输入 `vnc://树莓派IP地址:5901` ,其中5901是默认的端口。
![](http://7xjsv3.com1.z0.glb.clouddn.com/15153356804072.jpg)
点击连接，输入你刚刚确定的密码，即可完成连接，看到你的树莓派桌面环境。

好了，这就是系统安装的基本过程，下一步是更深入的折腾的过程。

1. 使用 `SSR` 全局代理，让树莓派自由访问网络。
2. 使用树莓派接入 `Google Assistant`，实现一个树莓派版的 `Google Home`。
3. 使用树莓派接入有线音箱，将其变成无线音箱。
4. 将树莓派安装 `Homebridge`，使你的 iPhone 连接你的智能设备。
